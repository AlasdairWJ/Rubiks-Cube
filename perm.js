function permute(config, perm) {
	var newConfig = new Array(54);
	for (var i=0; i<54; i++) {
		newConfig[i] = config[perm[i]];
	}
	return newConfig;
}

var moves = {
	Id: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53],

	F:  [0,1,2,3,4,5,35,23,11,9,10,45,36,24,12,6,16,17,18,19,20,21,22,46,37,25,13,7,28,29,30,31,32,33,34,47,38,26,14,8,40,41,42,43,44,39,27,15,48,49,50,51,52,53],
	B:  [17,29,41,3,4,5,6,7,8,2,10,11,12,13,14,15,16,53,42,30,18,1,22,23,24,25,26,27,28,52,43,31,19,0,34,35,36,37,38,39,40,51,44,32,20,45,46,47,48,49,50,9,21,33],
	U:  [6,3,0,7,4,1,8,5,2,12,13,14,15,16,17,18,19,20,9,10,11,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53],
	D:  [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,42,43,44,33,34,35,36,37,38,39,40,41,51,48,45,52,49,46,53,50,47],
	L:  [44,1,2,32,4,5,20,7,8,33,21,9,0,13,14,15,16,17,18,19,51,34,22,10,3,25,26,27,28,29,30,31,48,35,23,11,6,37,38,39,40,41,42,43,45,12,46,47,24,49,50,36,52,53],
	R:  [0,1,14,3,4,26,6,7,38,9,10,11,12,13,47,39,27,15,8,19,20,21,22,23,24,25,50,40,28,16,5,31,32,33,34,35,36,37,53,41,29,17,2,43,44,45,46,42,48,49,30,51,52,18],

	M:  [0,43,2,3,31,5,6,19,8,9,10,11,12,1,14,15,16,17,18,52,20,21,22,23,24,4,26,27,28,29,30,49,32,33,34,35,36,7,38,39,40,41,42,46,44,45,13,47,48,25,50,51,37,53],
	E:  [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,30,31,32,21,22,23,24,25,26,27,28,29,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53],
	S:  [0,1,2,34,22,10,6,7,8,9,48,11,12,13,14,15,3,17,18,19,20,21,49,23,24,25,26,27,4,29,30,31,32,33,50,35,36,37,38,39,5,41,42,43,44,45,46,47,40,28,16,51,52,53],

	F2: [0,1,2,3,4,5,47,46,45,9,10,39,38,37,36,35,16,17,18,19,20,21,22,27,26,25,24,23,28,29,30,31,32,33,34,15,14,13,12,11,40,41,42,43,44,8,7,6,48,49,50,51,52,53],
	B2: [53,52,51,3,4,5,6,7,8,41,10,11,12,13,14,15,16,33,44,43,42,29,22,23,24,25,26,27,28,21,32,31,30,17,34,35,36,37,38,39,40,9,20,19,18,45,46,47,48,49,50,2,1,0],
	U2: [8,7,6,5,4,3,2,1,0,15,16,17,18,19,20,9,10,11,12,13,14,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53],
	D2: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,39,40,41,42,43,44,33,34,35,36,37,38,53,52,51,50,49,48,47,46,45],
	L2: [45,1,2,48,4,5,51,7,8,35,34,33,44,13,14,15,16,17,18,19,36,23,22,21,32,25,26,27,28,29,30,31,24,11,10,9,20,37,38,39,40,41,42,43,12,0,46,47,3,49,50,6,52,53],
	R2: [0,1,47,3,4,50,6,7,53,9,10,11,12,13,42,41,40,39,38,19,20,21,22,23,24,25,30,29,28,27,26,31,32,33,34,35,36,37,18,17,16,15,14,43,44,45,46,2,48,49,5,51,52,8],
	
	M2: [0,46,2,3,49,5,6,52,8,9,10,11,12,43,14,15,16,17,18,37,20,21,22,23,24,31,26,27,28,29,30,25,32,33,34,35,36,19,38,39,40,41,42,13,44,45,1,47,48,4,50,51,7,53],
	E2: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,27,28,29,30,31,32,21,22,23,24,25,26,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53],
	S2: [0,1,2,50,49,48,6,7,8,9,40,11,12,13,14,15,34,17,18,19,20,21,28,23,24,25,26,27,22,29,30,31,32,33,16,35,36,37,38,39,10,41,42,43,44,45,46,47,5,4,3,51,52,53],

	F3: [0,1,2,3,4,5,15,27,39,9,10,8,14,26,38,47,16,17,18,19,20,21,22,7,13,25,37,46,28,29,30,31,32,33,34,6,12,24,36,45,40,41,42,43,44,11,23,35,48,49,50,51,52,53],
	B3: [33,21,9,3,4,5,6,7,8,51,10,11,12,13,14,15,16,0,20,32,44,52,22,23,24,25,26,27,28,1,19,31,43,53,34,35,36,37,38,39,40,2,18,30,42,45,46,47,48,49,50,41,29,17],
	U3: [2,5,8,1,4,7,0,3,6,18,19,20,9,10,11,12,13,14,15,16,17,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53],
	D3: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,36,37,38,39,40,41,42,43,44,33,34,35,47,50,53,46,49,52,45,48,51],
	L3: [12,1,2,24,4,5,36,7,8,11,23,35,45,13,14,15,16,17,18,19,6,10,22,34,48,25,26,27,28,29,30,31,3,9,21,33,51,37,38,39,40,41,42,43,0,44,46,47,32,49,50,20,52,53],
	R3: [0,1,42,3,4,30,6,7,18,9,10,11,12,13,2,17,29,41,53,19,20,21,22,23,24,25,5,16,28,40,50,31,32,33,34,35,36,37,8,15,27,39,47,43,44,45,46,14,48,49,26,51,52,38],
	
	M3: [0,13,2,3,25,5,6,37,8,9,10,11,12,46,14,15,16,17,18,7,20,21,22,23,24,49,26,27,28,29,30,4,32,33,34,35,36,52,38,39,40,41,42,1,44,45,43,47,48,31,50,51,19,53],
	E3: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,24,25,26,27,28,29,30,31,32,21,22,23,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53],
	S3: [0,1,2,16,28,40,6,7,8,9,5,11,12,13,14,15,50,17,18,19,20,21,4,23,24,25,26,27,49,29,30,31,32,33,3,35,36,37,38,39,48,41,42,43,44,45,46,47,10,22,34,51,52,53],

	m1: [0,43,2,3,31,5,6,19,8,9,10,11,12,1,14,15,16,17,18,52,20,21,22,23,24,4,26,27,28,29,30,49,32,33,34,35,36,7,38,39,40,41,42,46,44,45,13,47,48,25,50,51,37,53],
	e1: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,30,31,32,21,22,23,24,25,26,27,28,29,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53],
	s1: [0,1,2,34,22,10,6,7,8,9,48,11,12,13,14,15,3,17,18,19,20,21,49,23,24,25,26,27,4,29,30,31,32,33,50,35,36,37,38,39,5,41,42,43,44,45,46,47,40,28,16,51,52,53],

	X:  [12,13,14,24,25,26,36,37,38,11,23,35,45,46,47,39,27,15,8,7,6,10,22,34,48,49,50,40,28,16,5,4,3,9,21,33,51,52,53,41,29,17,2,1,0,44,43,42,32,31,30,20,19,18],
	Y:  [6,3,0,7,4,1,8,5,2,12,13,14,15,16,17,18,19,20,9,10,11,24,25,26,27,28,29,30,31,32,21,22,23,36,37,38,39,40,41,42,43,44,33,34,35,47,50,53,46,49,52,45,48,51],
	Z:  [33,21,9,34,22,10,35,23,11,51,48,45,36,24,12,6,3,0,20,32,44,52,49,46,37,25,13,7,4,1,19,31,43,53,50,47,38,26,14,8,5,2,18,30,42,39,27,15,40,28,16,41,29,17],

	X2: [45,46,47,48,49,50,51,52,53,35,34,33,44,43,42,41,40,39,38,37,36,23,22,21,32,31,30,29,28,27,26,25,24,11,10,9,20,19,18,17,16,15,14,13,12,0,1,2,3,4,5,6,7,8],
	Y2: [8,7,6,5,4,3,2,1,0,15,16,17,18,19,20,9,10,11,12,13,14,27,28,29,30,31,32,21,22,23,24,25,26,39,40,41,42,43,44,33,34,35,36,37,38,53,52,51,50,49,48,47,46,45],
	Z2: [53,52,51,50,49,48,47,46,45,41,40,39,38,37,36,35,34,33,44,43,42,29,28,27,26,25,24,23,22,21,32,31,30,17,16,15,14,13,12,11,10,9,20,19,18,8,7,6,5,4,3,2,1,0],

	X3: [44,43,42,32,31,30,20,19,18,33,21,9,0,1,2,17,29,41,53,52,51,34,22,10,3,4,5,16,28,40,50,49,48,35,23,11,6,7,8,15,27,39,47,46,45,12,13,14,24,25,26,36,37,38],
	Y3: [2,5,8,1,4,7,0,3,6,18,19,20,9,10,11,12,13,14,15,16,17,30,31,32,21,22,23,24,25,26,27,28,29,42,43,44,33,34,35,36,37,38,39,40,41,51,48,45,52,49,46,53,50,47],
	Z3: [17,29,41,16,28,40,15,27,39,2,5,8,14,26,38,47,50,53,42,30,18,1,4,7,13,25,37,46,49,52,43,31,19,0,3,6,12,24,36,45,48,51,44,32,20,11,23,35,10,22,34,9,21,33],
};

var instructionsMap = {
	"l": moves.L, "l2": moves.L2, "l'": moves.L3,
	"r": moves.R, "r2": moves.R2, "r'": moves.R3,
	"u": moves.U, "u2": moves.U2, "u'": moves.U3,
	"d": moves.D, "d2": moves.D2, "d'": moves.D3,
	"f": moves.F, "f2": moves.F2, "f'": moves.F3,
	"b": moves.B, "b2": moves.B2, "b'": moves.B3,
	"m": moves.M, "m2": moves.M2, "m'": moves.M3,
	"e": moves.E, "e2": moves.E2, "e'": moves.E3,
	"s": moves.S, "s2": moves.S2, "s'": moves.S3,
	"x": moves.X, "x2": moves.X2, "x'": moves.X3,
	"y": moves.Y, "y2": moves.Y2, "y'": moves.Y3,
	"z": moves.Z, "z2": moves.Z2, "z'": moves.Z3
};

function parse(instructions) {
	var tokens = instructions.toLowerCase().split(" ");
	var config = moves.Id;
	for (var i = 0; i < tokens.length; i++) {
		var token = tokens[i];
		if (token == "")
			continue;
		if (token in instructionsMap) {
			var perm = instructionsMap[token];
			config = permute(config, perm);
		} else {
			return [];
		}
	}
	return config;
}